import Head from 'next/head'
import { app, db } from '../firebase'
import {
  Container,
  Typography,
  Paper
} from '@mui/material';
import { useEffect,useState } from 'react';
import { useRouter } from 'next/router';
import { getAuth,onAuthStateChanged } from 'firebase/auth';
import { collection, getDocs } from "firebase/firestore"; 
import FooterBar from '../component/FooterBar';
import DataList from '../component/DataList';

export default function Home() {
  const [userAcc,setUserAcc] = useState(null)
  const router = useRouter();
  const auth = getAuth();
  const [dataCol,setDataCol] = useState(null)
  const colref = collection(db,'spending');
  
  

  // retrieving data from firestore
  const getData = async() => {
    getDocs(colref)
    .then(res => {
      setDataCol(res.docs.map(item => {
        return {...item.data(), id : item.id}
      }))
      console.log(dataCol);
    }).catch(err => {
      console.log(err.message)
    })
  }

  useEffect(() => {
    const token = sessionStorage.getItem('Token')
    onAuthStateChanged(auth, (user) => {
      if(!user) {
        router.push('/login');
      }
      if(token) {
        getData();
      }
      setUserAcc(user);
    })
    
  },[])


  return (
    <>
      <Head>
        <title>Spending Tracker</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
        <Container maxWidth='md'
        sx={{
          display : 'flex',
          flexDirection : 'column',
          height : '100vh'
        }}
        >
          <Paper
          sx={{
            display : 'flex',
            alignItems : 'center',
            justifyContent : 'space-between',
            padding : '10px',
            mt : '10px',
            width : '100%',
            maxWidth : '500px',
            alignSelf : 'center',
            backgroundColor : '#B0DB43',
          }}
          >
            <Typography variant='h6' component='h1' gutterBottom
            sx={{color : '#323031', fontFamily : 'Quicksand'}}
            >
              Your wallet balance : 
            </Typography>
            <Typography variant='h6' component='h1' gutterBottom
            sx={{color : '#323031', fontFamily : 'Quicksand'}}
            >
              Rp. 100.000
            </Typography>
          </Paper>
          {/* {dataCol.map(data => (
            <p>{data.amount}</p>
          ))} */}
        </Container>
        <FooterBar />
    </>
  )
}
